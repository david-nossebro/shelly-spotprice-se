const INSTANCE_COUNT = 1;
const HIST_LEN = 0;

/**
 * shelly-spotprice-se
 *
 * https://github.com/david-nossebro/shelly-spotprice-se
 *
 * Special thanks to Jussi isotalo who created the original repo
 * available here:
 * https://github.com/jisotalo/shelly-porssisahko
 * https://github.com/jisotalo/shelly-porssisahko-en
 *
 * @license GNU Affero General Public License v3.0
 */
const CNST={INST_COUNT:"undefined"==typeof INSTANCE_COUNT?3:INSTANCE_COUNT,HIST_LEN:"undefined"==typeof HIST_LEN?24:HIST_LEN,ERR_LIMIT:3,ERR_DELAY:120,DEF_INST_ST:{chkTs:0,st:0,str:"",cmd:-1,configOK:0,fCmdTs:0,fCmd:0},DEF_CFG:{COM:{g:"SE3",vat:25,day:0,night:0,names:[]},INST:{en:0,mode:0,m0:{c:0},m1:{l:0},m2:{p:24,c:0,l:-999,s:0,m:999,ps:0,pe:23,ps2:0,pe2:23,c2:0},b:0,e:0,o:[0],f:0,fc:0,i:0,m:60,oc:0}}},_={s:{v:"4.0.0",dn:"",configOK:0,timeOK:0,errCnt:0,errTs:0,upTs:0,tz:"+02:00",tzh:0,enCnt:0,p:[{ts:0,now:0,low:0,high:0,avg:0},{ts:0,now:0,low:0,high:0,avg:0}]},si:[CNST.DEF_INST_ST],p:[[],[]],h:[],c:{c:CNST.DEF_CFG.COM,i:[CNST.DEF_CFG.INST]}};let _i=0,_j=0,_k=0,_inc,_cnt=0,_start=0,_end=0;const cmd=[];let prevEpoch=0,loopRunning=!1;function isCurrentHour(e,t){return 0<=(t-=e)&&t<3600}function limit(e,t,n){return Math.min(n,Math.max(e,t))}function updateState(){var e=new Date,t=(_.s.timeOK=null!==Shelly.getComponentStatus("sys").unixtime&&2e3<e.getFullYear(),_.s.dn=Shelly.getComponentConfig("sys").device.name,epoch(e));for(_.s.timeOK&&300<Math.abs(t-prevEpoch)&&(log("Time changed 5 min+ -> refresh"),_.s.p[0].ts=0,_.s.p[0].now=0,_.s.p[1].ts=0,_.p[0]=[],_.p[1]=[]),prevEpoch=t,_.s.enCnt=0,_i=0;_i<CNST.INST_COUNT;_i++)_.c.i[_i].en&&_.s.enCnt++;!_.s.upTs&&_.s.timeOK&&(_.s.upTs=epoch(e))}function getConfig(s){var e=getKvsKey(s);Shelly.call("KVS.Get",{key:e},function(e,t,n){s<0?_.c.c=e?JSON.parse(e.value):{}:_.c.i[s]=e?JSON.parse(e.value):{},"function"==typeof USER_CONFIG&&USER_CONFIG(s,!0),chkConfig(s,function(e){s<0?_.s.configOK=e?1:0:(log("config for #"+(s+1)+" read, enabled: "+_.c.i[s].en),_.si[s].configOK=e?1:0,_.si[s].chkTs=0),loopRunning=!1,Timer.set(500,!1,loop)})})}function pricesNeeded(e){var t=new Date;let n=!1;return n=1===e?_.s.timeOK&&0===_.s.p[1].ts&&14<=t.getHours():((e=getDate(new Date(1e3*_.s.p[0].ts))!==getDate(t))&&(_.s.p[1].ts=0,_.p[1]=[]),_.s.timeOK&&(0===_.s.p[0].ts||e)),_.s.errCnt>=CNST.ERR_LIMIT&&epoch(t)-_.s.errTs<CNST.ERR_DELAY?n=!1:_.s.errCnt>=CNST.ERR_LIMIT&&(_.s.errCnt=0),n}function getPrices(p){log("Fetching prices for "+_.c.c.g);try{log("fetching prices for day "+p);const g=new Date;updateTz(g);let e=g;var t=1+(e=1===p?new Date(g.getFullYear(),g.getMonth(),1+g.getDate()):e).getMonth(),s=(t<10?"0":"")+t,o=(e.getDate()<10?"0":"")+e.getDate();let n={url:"https://www.elprisetjustnu.se/api/v1/prices/"+e.getFullYear()+"/"+s+"-"+o+"_"+_.c.c.g+".json",timeout:5,ssl_ca:"*"};log("Request url: "+n.url),Shelly.call("HTTP.GET",n,function(e,t,s){n=null;try{if(0!==t||null===e||200!==e.code||!e.body)throw Error(t+"("+s+") - "+JSON.stringify(e));{e.headers=null,s=e.message=null,_.p[p]=[],_.s.p[p].avg=0,_.s.p[p].high=-999,_.s.p[p].low=999;var o=JSON.parse(e.body),i=(e=null,(100+_.c.c.vat)/100);let n=0;for(let t=0;t<o.length;t++){var r=o[t];let e=r.SEK_per_kWh;var c=new Date(r.time_start.slice(0,-5)),l=c.getHours();const epoch=Math.floor(c.getTime()/1e3);0<e&&(e*=i),e+=6<=l&&l<22?_.c.c.day:_.c.c.night,_.p[p].push([epoch,e]),_.s.p[p].high<e&&(_.s.p[p].high=e),_.s.p[p].low>e&&(_.s.p[p].low=e),n+=e}if(_.s.p[p].avg=0<o.length?n/o.length:0,_.s.p[p].ts=epoch(g),_.p[p].length<23)throw Error("invalid data received")}}catch(t){log("error getting prices: "+t),_.s.errCnt+=1,_.s.errTs=epoch(),_.s.p[p].ts=0,_.p[p]=[]}0===p&&reqLogic(),loopRunning=!1,Timer.set(500,!1,loop)})}catch(e){log("error getting prices: "+e),_.s.errCnt+=1,_.s.errTs=epoch(),_.s.p[p].ts=0,_.p[p]=[],0===p&&reqLogic(),loopRunning=!1,Timer.set(500,!1,loop)}}function logic(s){try{"function"==typeof USER_CONFIG&&USER_CONFIG(s,!1),cmd[s]=!1;var e,t,n,o=new Date;updateTz(o),updateCurrentPrice();const r=_.si[s],c=_.c.i[s];function i(e){if(null===e)loopRunning=!1;else if(cmd[s]!==e&&(r.st=12),cmd[s]=e,c.i&&(cmd[s]=!cmd[s]),log("logic for #"+(s+1)+" done, cmd: "+e+" -> output: "+cmd[s]),1===c.oc&&r.cmd===cmd[s])log("outputs already set for #"+(s+1)),r.cmd=cmd[s]?1:0,r.chkTs=epoch(),loopRunning=!1;else{let t=0,n=0;for(let e=0;e<c.o.length;e++)setRelay(s,c.o[e],function(e){t++,e&&n++,t===c.o.length&&(n===t&&(r.cmd!==cmd[s]&&addHistory(s),r.cmd=cmd[s]?1:0,r.chkTs=epoch(),Timer.set(500,!1,loop)),loopRunning=!1)})}}0===c.mode?(cmd[s]=1===c.m0.c,r.st=1):_.s.timeOK&&0<_.s.p[0].ts&&getDate(new Date(1e3*_.s.p[0].ts))===getDate(o)?1===c.mode?(cmd[s]=_.s.p[0].now<=("avg"===c.m1.l?_.s.p[0].avg:c.m1.l),r.st=cmd[s]?2:3):2===c.mode&&(cmd[s]=isCheapestHour(s),r.st=cmd[s]?5:4,!cmd[s]&&_.s.p[0].now<=("avg"===c.m2.l?_.s.p[0].avg:c.m2.l)&&(cmd[s]=!0,r.st=6),cmd[s])&&_.s.p[0].now>("avg"===c.m2.m?_.s.p[0].avg:c.m2.m)&&(cmd[s]=!1,r.st=11):_.s.timeOK?(r.st=7,e=1<<o.getHours(),(c.b&e)==e&&(cmd[s]=!0)):(cmd[s]=1===c.e,r.st=8),_.s.timeOK&&0<c.f&&(t=1<<o.getHours(),(c.f&t)==t)&&(n=(c.fc&t)==t,cmd[s]=n,r.st=10),cmd[s]&&_.s.timeOK&&o.getMinutes()>=c.m&&(r.st=13,cmd[s]=!1),_.s.timeOK&&0<r.fCmdTs&&(0<r.fCmdTs-epoch(o)?(cmd[s]=1===r.fCmd,r.st=9):r.fCmdTs=0),"function"==typeof USER_OVERRIDE?USER_OVERRIDE(s,cmd[s],i):i(cmd[s])}catch(e){log("error running logic: "+JSON.stringify(e)),loopRunning=!1}}const getKvsKey=function(e){let t="sptprc-se";return t=0<=e?t+"-"+(e+1):t},epoch=function(e){return Math.floor((e?e.getTime():Date.now())/1e3)},getDate=function(e){return e.getDate()},updateTz=function(e){let t=e.toString(),n=0;"+0000"===(t=t.substring(3+t.indexOf("GMT")))?(t="Z",n=0):(n=+t.substring(0,3),t=t.substring(0,3)+":"+t.substring(3)),t!==_.s.tz&&(_.s.p[0].ts=0),_.s.tz=t,_.s.tzh=n},log=function(e){console.log("shelly-spotprice-se: "+e)},addHistory=function(e){for(var t=0<_.s.enCnt?CNST.HIST_LEN/_.s.enCnt:CNST.HIST_LEN;0<CNST.HIST_LEN&&_.h[e].length>=t;)_.h[e].splice(0,1);_.h[e].push([epoch(),cmd[e]?1:0,_.si[e].st])},reqLogic=function(){for(let e=0;e<CNST.INST_COUNT;e++)_.si[e].chkTs=0},chkConfig=function(e,t){let n=0;if(CNST.DEF_CFG.COM||CNST.DEF_CFG.INST){var s=e<0?CNST.DEF_CFG.COM:CNST.DEF_CFG.INST,o=e<0?_.c.c:_.c.i[e];for(const i in s)if(void 0===o[i])o[i]=s[i],n++;else if("object"==typeof s[i])for(const r in s[i])void 0===o[i][r]&&(o[i][r]=s[i][r],n++);e>=CNST.INST_COUNT-1&&(CNST.DEF_CFG.COM=null,CNST.DEF_CFG.INST=null),0<n?(e=getKvsKey(e),Shelly.call("KVS.Set",{key:e,value:JSON.stringify(o)},function(e,t,n,s){t&&log("failed to set config: "+t+" - "+n),s(0===t)},t)):t(!0)}else t(!0)},loop=function(){try{if(!loopRunning)if(loopRunning=!0,updateState(),_.s.configOK)if(pricesNeeded(0))getPrices(0);else if(pricesNeeded(1))getPrices(1);else{for(let e=0;e<CNST.INST_COUNT;e++)if(!_.si[e].configOK)return void getConfig(e);for(let e=0;e<CNST.INST_COUNT;e++)if(function(e){const t=_.si[e],n=_.c.i[e];if(n.en!==1){_.h[e]=[];return false}const s=new Date,o=new Date(t.chkTs*1e3);return t.chkTs===0||o.getHours()!==s.getHours()||o.getFullYear()!==s.getFullYear()||t.fCmdTs>0&&t.fCmdTs-epoch(s)<0||t.fCmdTs===0&&n.m<60&&s.getMinutes()>=n.m&&t.cmd+n.i===1}(e))return void Timer.set(500,!1,logic,e);"function"==typeof USER_LOOP?USER_LOOP():loopRunning=!1}else getConfig(-1)}catch(e){log("error at main loop:"+e),loopRunning=!1}},setRelay=function(e,o,i){e="{id:"+o+",on:"+(cmd[e]?"true":"false")+"}";Shelly.call("Switch.Set",e,function(e,t,n,s){0!==t&&log("setting output "+o+" failed: "+t+" - "+n),i(0===t)},i)};let _avg=999,_startIndex=0,_sum=0;const isCheapestHour=function(e){var t=_.c.i[e],n=(t.m2.ps=limit(0,t.m2.ps,23),t.m2.pe=limit(t.m2.ps,t.m2.pe,24),t.m2.ps2=limit(0,t.m2.ps2,23),t.m2.pe2=limit(t.m2.ps2,t.m2.pe2,24),t.m2.c=limit(0,t.m2.c,0<t.m2.p?t.m2.p:t.m2.pe-t.m2.ps),t.m2.c2=limit(0,t.m2.c2,t.m2.pe2-t.m2.ps2),[]);for(_inc=t.m2.p<0?1:t.m2.p,_i=0;_i<_.p[0].length;_i+=_inc)if(!((_cnt=-2===t.m2.p&&1<=_i?t.m2.c2:t.m2.c)<=0)){var s=[];for(_start=_i,_end=_i+t.m2.p,t.m2.p<0&&0===_i?(_start=t.m2.ps,_end=t.m2.pe):-2===t.m2.p&&1===_i&&(_start=t.m2.ps2,_end=t.m2.pe2),_j=_start;_j<_end&&!(_j>_.p[0].length-1);_j++){var o=1<<_j;(t.f&o)==o&&(t.fc&o)!=o||s.push(_j)}if(t.m2.s){for(_avg=999,_startIndex=0,_j=0;_j<=s.length-_cnt;_j++){for(_sum=0,_k=_j;_k<_j+_cnt;_k++)_sum+=_.p[0][s[_k]][1];_sum/_cnt<_avg&&(_avg=_sum/_cnt,_startIndex=_j)}for(_j=_startIndex;_j<_startIndex+_cnt&&_j<s.length;_j++)n.push(s[_j])}else{for(_j=0,_k=1;_k<s.length;_k++){var i=s[_k];for(_j=_k-1;0<=_j&&_.p[0][i][1]<_.p[0][s[_j]][1];_j--)s[_j+1]=s[_j];s[_j+1]=i}for(_j=0;_j<_cnt;_j++)n.push(s[_j])}if(-1===t.m2.p||-2===t.m2.p&&1<=_i)break}var r=epoch();let c=!1;for(let e=0;e<n.length;e++){var l=_.p[0][n[e]];if(isCurrentHour(l[0],r)){c=!0;break}}return c},updateCurrentPrice=function(){if(_.s.timeOK&&0!==_.s.p[0].ts){var t=epoch();for(let e=0;e<_.p[0].length;e++)if(isCurrentHour(_.p[0][e][0],t))return _.s.p[0].now=_.p[0][e][1],!0;_.s.timeOK=!1,_.s.p[0].ts=0,_.s.errCnt+=1,_.s.errTs=epoch()}else _.s.p[0].ts=0,_.s.p[0].now=0};log("v."+_.s.v),log("URL: http://"+(Shelly.getComponentStatus("wifi").sta_ip||"192.168.33.1")+"/script/"+Shelly.getCurrentScriptId()),_.c.i.pop(),_.si.pop();for(let e=0;e<CNST.INST_COUNT;e++)_.si.push(Object.assign({},CNST.DEF_INST_ST)),_.c.i.push(Object.assign({},CNST.DEF_CFG.INST)),_.c.c.names.push("-"),_.h.push([]),cmd.push(!1);CNST.DEF_INST_ST=null,prevEpoch=epoch(),HTTPServer.registerEndpoint("",function(n,s){try{if(loopRunning)return n=null,s.code=503,void s.send();var o=function(e){var t={},n=e.split("&");for(let e=0;e<n.length;e++){var s=n[e].split("=");t[s[0]]=s[1]}return t}(n.query),i=parseInt(o.i);n=null;let e="application/json",t=(s.code=200,!0);var r="text/html",c="text/javascript";if("s"===o.r)updateState(),0<=i&&i<CNST.INST_COUNT&&(s.body=JSON.stringify({s:_.s,si:_.si[i],c:_.c.c,ci:_.c.i[i],p:_.p})),t=!1;else if("c"===o.r)updateState(),0<=i&&i<CNST.INST_COUNT?s.body=JSON.stringify(_.c.i[i]):s.body=JSON.stringify(_.c.c),t=!1;else if("h"===o.r)0<=i&&i<CNST.INST_COUNT&&(s.body=JSON.stringify(_.h[i])),t=!1;else if("r"===o.r){if(0<=i&&i<CNST.INST_COUNT)log("config changed for #"+(i+1)),_.si[i].configOK=!1;else{log("config changed");for(let e=0;e<CNST.INST_COUNT;e++)_.si[e].configOK=!1}_.s.configOK=!1,reqLogic(),loopRunning||(loopRunning=!0,getConfig(i)),_.s.p[0].ts=0,_.s.p[1].ts=0,s.code=204,t=!1}else"f"===o.r&&o.ts?(0<=i&&i<CNST.INST_COUNT&&(_.si[i].fCmdTs=+(""+o.ts),_.si[i].fCmd=+(""+o.c),_.si[i].chkTs=0),s.code=204,t=!1):o.r?"s.js"===o.r?(s.body=atob("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"),e=c):"s.css"===o.r?(s.body=atob("H4sIAAAAAAAAE5VW247bNhD9lUEWARLHsiXvJY6ELtqm2QBBExQo2peiD5Q0khhTJEGOfImxn5Nf2B/wjxWkLtZ6vQj6YljiDGfmnJkzmk8mMAFboRC7wGpF2vAMA4vg3ldE2sbzecmpatJZpup5ztY8D6SyFlOj5s95/qkx40wAVUyuLJCCT421HLhVxISCTaUgM8gIc6AKQRlecskEGNQKJsDWjAuWCoQKDcbnc/na3dZnoZWxlltWrdT/dghQ+sR/5xlKizF8/PIX/FIUaBR8RImGCfijSQXPehNYX85CmMxhAntI1Taw/BuXZQypMjmaIFXbBO4hVfluCgz2kCmhTAwXd7/dfbj70J85Z5atSqMamcdwEYaLX6+uExBcYlAhLyuKIZpdYZ1AoSS5MBhDOHs3vClYzcUuhr/R5EyyBGq2DTY8pyqGq3fG2XVPURi+dMem5DKGEFhDKgHN8txnfq23EIXa531BnATCfhy0S6P1D1JFpGrvlRyLu3v/dvHeX5ApvXvsH86Wzp8JXsrAoihiKARuA5R5AoRbCvxRDMaV7S6ZFWILe8i51YLtWnP/nlhqYQ9aWU5cORcUjPgak1M4bxh7O7jEcYqFMjjtH1lBaDw5klBSDC9eJMdw5Fpw5DxYC2TGMU1Vf+oqFYpRDAKLNneyU5hV4/SlksN1gWApivFpKlS2OmF+MXt77TAbOAohmi3cm67NTGent2CV4Lkr+apYpglkjbGOE624JDRD3K5U2D/uiiOULLVKNIQJfAu4zHEbQ5QAKX1Mx9UYQzjKK/J99gj7oiiOjdH3tdIs47Tzzh6jOKswW2H+5hEoP76orf/MPf6KNyelDmGjUVWL1lXpMQul4XnifwPCWgtGGGRKNLW0MUSF8UPj/nhnq+UIyNnCo3Ac2/Z5SNU/dzyRYdJqZlDSQOaxxrZru9ekdHA6YD39LOeNjeHaUcgkr1nLocsrsr6XmAEuCy65Y3Qok0vfZ13P3cPPK9wVhtVooa3JdQXs2zQLZeoYjCJG+OryJsyxfA33cN8OyCzLbslp2S2ZW8rjghtLQVZxkU9hlpbTzszWQGZ82qvDpsMrVSJPYI2GeMZELwak9PNDXYhtUCvHtPATiNsg5wazThTUxtdWY87Zq7EsLkO9fQ378yp140gb61E70p3u+UEIlno76p4ftEtveQuxpKot/tWliz+fwGe24rL0a/DS5NA6Q6nc1pS4JU/iZN7GaE9jiGAOQZQMFNRjBqZwka5un9OXR1N/1v+Eo67ubuZd3ce+9PM3bLx2IYSja58yPvaNnqrWDzltETg1vM35eki1S6FL4hjTOhHwIjqeOMG0W/j9v6cAHbM+m/F4fbZEZ25uRu2T4SDABR8L78sENhUn9Jmh2w8bw7Q33ETLcGS57C+vKQqPnLQodivb4RF1iHmhc+bmegyLX/Fhp5m1uD5lt4+STuHCBln9zIieavE9cKkb+od2Gn9KGyIl/z39dIge74cngjafwMedECjLRkDKVqVpZO6+r06DuZE5PJhVKg7fPcxQHB4MrJQkwyw5lzNsYZiGi6X3/nL4XiqC2l3CDIILuGJy5DnI6pXDwwX82qwYVIcHI53VQPnSfTHd9EZoQDSFv+fJ8j2DopfWbueeAuN2hQVkrh+7+HB4WKMpD99l6SKcwzyu1Np/oJzBeQTA577yNc+hdfEXDjK9P/Op2XViL2dHSXc9MgBy6bA43/u2qWtmnNg+/TL5D9JmFQyIDAAA"),e="text/css"):"status"===o.r?(s.body=atob("H4sIAAAAAAAAE5WSzU7DMBCEX8XKCSrl74DEwfUFTggEEk/geB3kyvYGe5OUt0f5qVugRXCxZH2zM7OWOcnGaqasjHGbOaZUJjgFwQnEvR6M0kx6YAo9BbScgBnYxhz8QbWOjvVtJZ576npiHsckVA7EI0ow/q0oiqNzVMF0ZNAnZaQU/BKm3FMbj2OiTwg6AYegE3klSUdkfIuCl/OCgoMZDlu2ds9au88dNrlCm32BpCZWMxdufgBHdZUJ3iwFIyME+cHLRvASzCD48pZzeGeqs9mnLnfLo16wWQZIrX4ndovqXGf7l84OQ8DxUu36H7V/daq/F17O2Hdis8FBh2BA83K6z0nz1JDWTvr5o4ig3x/iVUayySNJ6mOxi9k1L1f8Ce8QLX7HAgAA"),e=r):"status.js"===o.r?(s.body=atob("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"),e=c):"history"===o.r?(s.body=atob("H4sIAAAAAAAAE2WNOw7CMBBEr2K5giJY6TdbUdHQcAH/AoscHLybKLk9IgSElGaKefOBQKPyyTI3uk2TatNUddlVPieN8AfFv1mtEcS6FBGkIEj4YeWuGi/UxY15HqQfZGMfI/tCvVB+gFnGXA6zotBwdSMWBLM+mUDjVz8dLPF54p0W65ZsLvPhznoPZuUvUGxSH9cAAAA="),e=r):"history.js"===o.r?(s.body=atob("H4sIAAAAAAAAE22SUWvbMBDHv4p6ZENaEjdd2Eucc9jalT10KTTekzGtIp8TMdfKpEtKcP3dh51tpDDQw+k4/f7HDzUVsbCY5bFxdWCxRsak+RUkhPHWBgYV2bom/y39focwZ5/MuRDGVWGna5wmSye6MeeP80sukvkl+wTa+KC9MKjDsTaiA3Z3j+fYmP2xsaXk19eDs4WYIGJgzaQ88d7XYi1VbEsJrNfjPxGAiNqwPVCq16qHEuoXbVlsiG80a3m9XKWPPx7uVkNYeNy+twhDWwfuWRS5n6oLvZAWKSo0axVVVG94e5baUhVI2FJ+mkwvECkyrnizlT9XAnHpvDzJ08KVwkbBeZaSR15h4rNJPuZskqvTvuEkEUYBZXeG+NQLrXQICKVlSAZN6fyz5tQ+k6zpRdxoJnlF0w+657S96Sc17F8GPlaEYFzl/GzQ6OwqX8DGE9UwA08FtB3x1L7f827P4n4Js3/17S28ASaDpne4Sj+nXx9X6UOms495vvhfM/K0q7QhCULua7aVeBcUjADUDP5Sh3D6E+fWhhjatjWazVayajp5rqKIvHdeshqdC+a2jY1Uo+svq2i3D1tpVPsb/l3ez7UCAAA="),e=c):"config"===o.r?(s.body=atob("H4sIAAAAAAAAE5VWXW/iOBT9K1ZWq2kfAsRlqwoFSyzDbJktpGro9tk4F+LFsVPbgWF//SokgSSUfrwg5Ht97sm5X/YjvkU8GrLV2hWICWrM0DLyoGjE5brT6fjdiG+Jf3JDxu4FDCNuUkH3A6kkFObismMZWjqFz0pJ6xr+Hwy8DoaEjIPZLJijcLJYTOd/hSW0pUsB1e0EMeYQ32ri24iMVSat3ud/fQMCmM1JrImvUsuVRFsqMhiGE4+EO4hAoqtw0vOu22ZcN+Mz803dfHNm7tfN/Wu/WzCpSJbMd95dj/wzWhy4cplmB6pbalEuwPCGoN+rr1poKs0KNFoBmPygd+tiPECnaxHdH6/5JqWyDJJqzsDNJLeEdTcvsd/NjXX5E+v1CMZu77aOJ/k6tl9CLFLTPeSmnd48xjs5ni+eggf0WxElrxlOmqiXE17XciJzt+igp6BLEJWsdp/CkMXANkv1Kw8AkqBg3g1+/PC7pWep9Jwm0EyIPNpmKoJWYSUqAtLOLwljEGKPVGbTzJomnMqsKXTtH/1fNLfQcD9FUKxVuz0yEju6N81TjwTSZTGVazijM1bSaiVQwmVmocUn4fKY5oTL6s5UbkHbUswLKnK5Pcb4k7JNlqJYZToPkJuXm6N1koBeg2T7z+RG60vJCbagNY/KT4jAUi5MVcbiD+KbLEmo3pMwVrtuzKNci/KorCEeDVdxVUkmOVSmcyrbbgn6ZiGXVUxmo/nz6AHNgu+TL9VncEjwJyRIei5LojMV3qH0+DQdT9DDdDZdfInSY97MSPCE21ZZeK7gyUcDIJz83RgBlwmO7yejx0m4QPfB89PHc7zOccETQClorqJ292E3Bd3qD9wnuB+3ugMTD7fO7shd6+SW3LZO+qSNdENuWieYtJFdj7DMWJWgK68k3loRLj564NLDnNZEQ+2Y2Pz7dd7Zg0poq6uqxy4revwA18ohdlNTpXDQ6yEXNY1QM1Y9dq8yjVi+Rc/AmDxthLjJAddIIPwGDfwuD9wkcgZ8IvUGOJMWN3gVMxheM5CWU/HeCEuwa16P86UYrEjJs44o4Msbgief7Yhqc9BfHZS+2WsN5E/jXl6zTk0cQ7dQfPMys/b0QKFbILVX2tmePjy7RvPv4ZmTZRX86fHQiJDPV6UZlKGcGZUZFUiVk9sh/lJ/AKEkE5xtht92XEZq11EpyCun61x/KzHL9foCy+epc3x4HH4N0zy1RMPrT3PlWLp0mZIrvu78a5y8wQrz/zb57MjDCgAA"),e=r):"config.js"===o.r?(s.body=atob("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"),e=c):s.code=404:(s.body=atob("H4sIAAAAAAAAE6VTTW/bMAz9K5p2SbDYXm/DKqmHNtiwa4FeB0ViYq6KpImMg2DYfx/8kbVu163ALrRJPj4+PdnqjU+OTxla3gej+iiCjTsN0ag9sBWutYWA9YG31QejGDmAuc2Jc0EH4natmrE2wqPdg+4QjjkVFi5FhshaHtFzqz106KAakhVGZLShImcD6AtplMdOuGCJNKc8puj1HzZOHcoYpwHK0ajGY3eOQyAI4LiHYiQ2KmXGFEVnwwH0e3OdIpcUxNsL1YzQR9P9lEv5ZJQVbYGtbpkzfWyaHXJ72NQu7RtvO/RVTESwKamhFkI4VXSWWhEItmUHrL9ugo335tMwKwrkpBr7TPH59HZDT3KjMOYDi/6qdLEe0+i0HRyym4rY8oGEa8Hdg9fT80xARqhgNxDENpUZ/rygGtrmdiirZszmGqrpNgdnqgeSvxzjn7JbJE7l9LLOJ4DfQj+P9dcqnWj+R6pLcYu7l5XO+w+OAjPG3as9HWnmQsdIrmBm41IkFjfrO33E6NOxDsnZ/ruuU8EdxhqjCwcPtJB9J7SJWC4vA7Dw2id32EPklStgGdYB+kyDNr6elRawXNmcIfrrFoMfEZvkT/Wjag8q8P0L9e0fnS2C9JxFjqLl8pJqKk7frO+u4KO8Klq+g7pADtbBQvYHlyspZzsXtPy5cvSMMmC8l8tLR1QXCFoSnwJQC8Cyh9fD39ovklQ7IjmsG19n9I5okr+QVH8juVTN5PEv6C6PuxcFAAA="),e=r);s.headers=[["Content-Type",e]],t&&s.headers.push(["Content-Encoding","gzip"])}catch(e){log("server error: "+e),s.code=500}s.send()}),Timer.set(1e4,!0,loop),loop();
//end
